# PYGISS-2024 开发文档


## 项目概述

PYGISS-2024 是一个基于 Python 和 PyQt5 的 GIS 应用程序，旨在提供地图数据可视化、节点管理、属性查询和地图导出等功能。该应用程序的设计以模块化为原则，方便后续功能扩展和维护。



## 项目结构
```
PYGISS-2024/
├── core/
│   ├── PSF_Object.py              # 处理点、线、面对象的类定义
│   ├── mapData.py                 # 管理地图数据的主要逻辑
│   └── nodeData.py                # 管理节点数据的功能
│
├── test/
│   ├── test_integration.py         # 集成测试，验证各个模块的功能是否正常
│   ├── test_mapData.py             # 针对 mapData.py 模块的单元测试
│   ├── test_nodeData.py            # 针对 nodeData.py 模块的单元测试
│   └── test_UI.py                  # 针对用户界面的单元测试
│
├── ui/
│   ├── mapWidget.py                # 实现地图小部件，整合渲染和交互功能
│   ├── menu.py                     # 实现菜单功能，提供操作入口
│   └── mapWidget_components/       # 地图小部件的辅助组件
│       ├── baseRender.py           # 提供基本的渲染功能，作为 render.py 的辅助模块
│       ├── interaction.py          # 处理用户与地图的交互
│       ├── layerManager.py         # 管理图层的导入和投影
│       ├── render.py               # 整合渲染功能的主要模块
│       ├── renderUtils.py          # 提供渲染过程中的工具函数
│       └── tools.py                # 提供地图操作工具的功能
│
├── utils/
│   └── utils.py                    # 提供实用函数，例如坐标验证和错误消息显示
│
├── main.py                         # GIS 应用程序的入口文件
├── mainWindow.py                   # 实现主窗口的主要逻辑和交互
└── app.log                         # 记录应用程序运行的日志
```


## 代码功能和模块关系

### 1. 核心模块 (core)

- **mapData.py**: 管理地图数据，包括数据的读取和存储。
- **nodeData.py**: 处理节点数据，包括节点的创建、更新和删除。
- **PSF_Object.py**: 定义与 PSF 相关的对象和功能。

### 2. 用户界面模块 (ui)

- **menu.py**: 实现应用程序的菜单功能，包括导入、导出和属性查询等按钮。
- **mapWidget.py**: 实现地图小部件，集成渲染、交互和工具功能，处理用户的地图操作。

#### 组件功能模块 (ui/mapWidget_components)

- **baseRender.py**: 作为 `render.py` 的辅助模块，提供基础渲染功能。
- **interaction.py**: 提供与地图的交互功能，包括拖拽、缩放和选择，紧密关联 `mapWidget.py`。
- **layerManager.py**: 负责图层管理功能，包括导入 Shapefile、节点和更改地图投影，紧密关联 `mapWidget.py`。
- **tools.py**: 提供地图工具功能，包括属性查询和导出地图，紧密关联 `mapWidget.py`。
- **render.py**: 组合渲染相关的所有功能，与 `baseRender.py` 和 `renderUtils.py` 协作。
- **renderUtils.py**: 作为 `render.py` 的辅助模块，提供地图渲染的工具方法。

### 3. 辅助模块 (utils)

- **utils.py**: 提供实用函数，例如坐标验证和错误消息显示。

### 4. 主文件

- **main.py**: 应用程序的入口文件，设置日志记录并启动主窗口。
- **mainWindow.py**: 实现 GIS 应用程序的主窗口类，管理菜单和地图小部件的交互。



## 代码逻辑

1. **应用启动**: 
   - 从 `main.py` 启动应用程序，配置日志记录并创建主窗口 (`TGIS_MainWindow`)，该窗口管理整个应用的布局和逻辑。

2. **主窗口管理**: 
   - `mainWindow.py` 中的 `TGIS_MainWindow` 类负责初始化菜单、地图小部件及属性信息窗口，并处理用户交互。

3. **用户交互与地图操作**:
   - 用户通过菜单 (`menu.py`) 执行操作（如导入 Shapefile、查询属性等），这些操作通过信号与 `mapWidget.py` 及其组件进行连接。

4. **渲染与工具功能**:
   - 地图的渲染与交互功能由 `mapWidget_components` 下的多个模块实现，确保代码的高内聚性和低耦合性。

5. **数据处理**:
   - 核心模块 (`core`) 负责地图和节点数据的管理与操作，确保数据与界面的交互流畅。



## 功能总结

PYGISS-2024 提供以下主要功能：

### 优化后的旧功能

1. **地图数据的投影转换**  
   支持将地图数据从球面坐标（如 WGS84）转换为平面坐标，并提供三种常见的平面投影方式，包括北极投影、欧洲兰伯特等面积投影和世界墨卡托投影。这一功能经过优化后，增加了更多的投影选项，确保了地图数据在不同应用场景下的灵活性和实用性。

2. **节点管理**  
   用户可以导入包含地理坐标的 Excel 文件，以可视化方式显示这些节点，并且可以选择删除部分节点。节点管理经过改进后，允许用户对节点进行更细化的操作，使得数据处理更为灵活和高效。

3. **图层管理**  
   支持单个图层的导入和清除。用户可以方便地导入新的 Shapefile 文件，并清除当前图层，以确保地图展示的内容符合用户需求。经过优化后的图层管理功能使得地理数据的可视化更加高效和简便。

### PYGISS-2024新功能

1. **属性查询与显示**  
   用户可以根据指定的属性字段和值进行查询，查询结果的详细属性会展示在侧边栏的属性信息窗口中。此外，用户可以打开属性表，查看所有地图要素的完整属性数据。这一功能提升了系统的交互性，便于用户快速进行数据筛选与分析。

2. **地图导出功能**  
   提供将当前地图导出为多种格式（PNG、PDF、JPEG）的选项。用户可以保存当前地图的可视化结果，方便后续的分享和报告生成。这一功能极大增强了用户将地图输出为高质量文件的能力，提升了软件的实用性和便利性。

3. **节点显示尺寸调整**  
   用户可以通过滑块来动态调整地图上节点的显示尺寸，节点图标的大小会即时改变。此功能为用户提供了灵活的可视化设置，使得地图显示效果可以根据不同需求进行定制，从而提升了用户体验。


## 结论

PYGISS-2024 是一个功能全面的 GIS 应用程序，采用模块化设计，便于后续扩展和维护。代码结构清晰，各个模块之间关系紧密，能够实现高效的地图数据管理与展示。

